<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- <link rel="stylesheet" href="./output.css" /> -->
    <title>SQL insert generator</title>
  </head>

  <body>
    <form action="">
      <div>
        <label for="table-name">Table name</label>
        <input type="text" id="table-name" />
      </div>
      <div>
        <label for="rows-number">Rows number</label>
        <input type="text" id="rows-number" />
      </div>
      <div>
        <label for="column-types">Column types</label>
        <input type="text" id="column-types" />
      </div>

      <button type="submit">Submit</button>
    </form>

    <script type="module">
      import { faker } from "https://esm.sh/@faker-js/faker";

      document
        .querySelector("form")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const tableName = document.getElementById("table-name").value;
          const rowsNumber = document.getElementById("rows-number").value;
          const columnTypesInputValue =
            document.getElementById("column-types").value;

          if (!tableName || !rowsNumber || !columnTypesInputValue) return;

          const columnTypes = columnTypesInputValue.split(/,\s*(?![^()]*\))/);

          const fieldValuesFunctions = [];

          columnTypes.forEach((columnType) => {
            switch (true) {
              case columnType.includes("VARCHAR"): {
                const func = () => {
                  const max = Number(
                    columnType.slice(8, columnType.length - 1)
                  );
                  const result = faker.lorem.words({ min: 1, max: 6500 }); // considering each word having in media 10 characters, the limit is not yet violated even considering max number chosen

                  return result.length > max || result.length > 65535
                    ? result.substring(0, max - 1)
                    : result; // but if the number shows as greater, the string is sliced to fit the max size allowed
                };
                fieldValuesFunctions.push(func);
                break;
              }

              case columnType.includes("CHAR"): {
                const func = () => {
                  const max = Number(
                    columnType.slice(5, columnType.length - 1)
                  );
                  const result = faker.lorem.words({ min: 1, max: 20 });

                  return result.length > max || result.length > 255
                    ? result.substring(0, max - 1)
                    : result;
                };
                fieldValuesFunctions.push(func);
                break;
              }

              case columnType.includes("TEXT"): {
                const func = () => {
                  const max = 65535;
                  const result = faker.lorem.paragraphs({ min: 1, max: 500 });

                  return result.length > max
                    ? result.substring(0, max - 1)
                    : result;
                };
                fieldValuesFunctions.push(func);
                break;
              }

              case columnType.includes("ENUM"): {
                const func = () => {
                  const enumOptions = columnType
                    .slice(5, columnType.length - 1)
                    .split(",");

                  return faker.helpers.arrayElement(enumOptions);
                };
                fieldValuesFunctions.push(func);
                break;
              }
            }
          });

          let query = `INSERT INTO ${tableName} VALUES `;
          for (let i = 0; i < rowsNumber; i++) {
            query = query + `(`;
            fieldValuesFunctions.forEach((func) => {
              query = query + `${func()},`;
            });
            query = query.slice(0, -1);
            query = query + `),`;
          }
          query = query.slice(0, -1) + ";";

          console.log(query);
        });
    </script>
  </body>
</html>
